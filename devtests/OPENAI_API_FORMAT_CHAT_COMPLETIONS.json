{
  "description": "OpenAI-compatible Chat Completions: request/response schemas and streaming chunk shape",
  "version": "1.0.0",
  "schemas": {
    "request": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "title": "ChatCompletionsRequest",
      "type": "object",
      "required": ["model", "messages"],
      "properties": {
        "model": { "type": "string", "description": "Alias or provider/model" },
        "messages": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["role", "content"],
            "properties": {
              "role": { "type": "string", "enum": ["system", "user", "assistant", "tool"] },
              "name": { "type": "string" },
              "tool_call_id": { "type": "string" },
              "content": {
                "description": "String or multimodal parts (text, image)",
                "oneOf": [
                  { "type": "string" },
                  {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                      "type": "object",
                      "required": ["type"],
                      "properties": {
                        "type": { "type": "string", "enum": ["text", "input_image"] },
                        "text": { "type": "string" },
                        "image_url": {
                          "type": "object",
                          "required": ["url"],
                          "properties": {
                            "url": { "type": "string" },
                            "detail": { "type": "string", "enum": ["auto", "low", "high"] }
                          }
                        },
                        "image_data": {
                          "type": "object",
                          "required": ["b64_json"],
                          "properties": { "b64_json": { "type": "string" } }
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "stream": { "type": "boolean", "default": false },
        "temperature": { "type": "number", "minimum": 0, "maximum": 2 },
        "top_p": { "type": "number", "minimum": 0, "maximum": 1 },
        "n": { "type": "integer", "minimum": 1, "maximum": 10 },
        "stop": { "oneOf": [ { "type": "string" }, { "type": "array", "items": { "type": "string" }, "maxItems": 4 } ] },
        "max_tokens": { "type": "integer", "minimum": 1 },
        "presence_penalty": { "type": "number", "minimum": -2, "maximum": 2 },
        "frequency_penalty": { "type": "number", "minimum": -2, "maximum": 2 },
        "logit_bias": { "type": "object", "additionalProperties": { "type": "number" } },
        "user": { "type": "string" },
        "tools": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "function"],
            "properties": {
              "type": { "type": "string", "enum": ["function"] },
              "function": {
                "type": "object",
                "required": ["name", "parameters"],
                "properties": {
                  "name": { "type": "string" },
                  "description": { "type": "string" },
                  "parameters": { "type": "object" }
                }
              }
            }
          }
        },
        "tool_choice": {
          "oneOf": [
            { "type": "string", "enum": ["none", "auto", "required"] },
            { "type": "object", "required": ["type", "function"], "properties": { "type": { "type": "string", "enum": ["function"] }, "function": { "type": "object", "required": ["name"], "properties": { "name": { "type": "string" } } } } }
          ]
        },
        "response_format": {
          "oneOf": [
            { "type": "string", "enum": ["text"] },
            { "type": "object", "required": ["type"], "properties": { "type": { "type": "string", "enum": ["json_schema"] }, "json_schema": { "type": "object" } } }
          ]
        }
      }
    },
    "response": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "title": "ChatCompletionsResponse",
      "type": "object",
      "required": ["id", "object", "created", "model", "choices"],
      "properties": {
        "id": { "type": "string" },
        "object": { "type": "string", "const": "chat.completion" },
        "created": { "type": "integer" },
        "model": { "type": "string" },
        "choices": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["index", "message", "finish_reason"],
            "properties": {
              "index": { "type": "integer" },
              "message": {
                "type": "object",
                "required": ["role"],
                "properties": {
                  "role": { "type": "string", "enum": ["assistant"] },
                  "content": { "type": ["string", "null"] },
                  "tool_calls": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": ["type", "id", "function"],
                      "properties": {
                        "id": { "type": "string" },
                        "type": { "type": "string", "enum": ["function"] },
                        "function": { "type": "object", "required": ["name", "arguments"], "properties": { "name": { "type": "string" }, "arguments": { "type": "string" } } }
                      }
                    }
                  }
                }
              },
              "finish_reason": { "type": ["string", "null"], "enum": ["stop", "length", "content_filter", "tool_calls", null] }
            }
          }
        },
        "usage": {
          "type": "object",
          "required": ["prompt_tokens", "completion_tokens", "total_tokens"],
          "properties": { "prompt_tokens": { "type": "integer" }, "completion_tokens": { "type": "integer" }, "total_tokens": { "type": "integer" } }
        }
      }
    },
    "streaming_chunk": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "title": "ChatCompletionsStreamingChunk",
      "type": "object",
      "required": ["id", "object", "created", "model", "choices"],
      "properties": {
        "id": { "type": "string" },
        "object": { "type": "string", "const": "chat.completion.chunk" },
        "created": { "type": "integer" },
        "model": { "type": "string" },
        "choices": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["index", "delta", "finish_reason"],
            "properties": {
              "index": { "type": "integer" },
              "delta": { "type": "object", "properties": { "role": { "type": "string", "enum": ["assistant"] }, "content": { "type": ["string", "null"] }, "tool_calls": { "type": "array" } } },
              "finish_reason": { "type": ["string", "null"] }
            }
          }
        }
      }
    }
  }
}
