# Default: JSON formatter for structured logging with context
# To use human-readable format, set LOG_FORMAT env var to: line, or json (default)
when@prod: &prod_config
    monolog:
        handlers:
            main:
                type: stream
                path: php://stderr
                level: debug
                formatter: app.monolog_formatter
                process_psr_3_messages: false

when@dev:
    <<: *prod_config

services:
    # The formatter - created by factory based on LOG_FORMAT env var
    app.monolog_formatter:
        class: Monolog\Formatter\FormatterInterface
        factory: ['@App\Service\MonologFormatterFactory', 'createFormatter']

parameters:
    env(LOG_FORMAT): ''
    default_log_format: 'json'
