framework:
    messenger:
        failure_transport: failed

        transports:
            # High Priority: AI Processing
            async_ai_high:
                dsn: 'doctrine://default?queue_name=ai_high'
                retry_strategy:
                    max_retries: 3
                    delay: 1000
                    multiplier: 2
                    max_delay: 10000

            # Medium Priority: File Extraction
            async_extract:
                dsn: 'doctrine://default?queue_name=extract'
                retry_strategy:
                    max_retries: 2
                    delay: 2000

            # Low Priority: Indexing
            async_index:
                dsn: 'doctrine://default?queue_name=index'
                retry_strategy:
                    max_retries: 5
                    delay: 5000

            # Failed Messages (Dead-Letter-Queue)
            failed:
                dsn: 'doctrine://default?queue_name=failed'

        routing:
            # Route your messages to the transports
            'App\Message\ProcessMessageCommand': async_ai_high

when@test:
    framework:
        messenger:
            transports:
                async_ai_high: 'in-memory://'
                async_extract: 'in-memory://'
                async_index: 'in-memory://'
                failed: 'in-memory://'
