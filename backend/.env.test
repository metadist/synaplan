###> SYMFONY TEST ENVIRONMENT ###
# Must define every env var referenced in config without default (services.yaml, framework, etc.)
# so the container never throws "Environment variable not found". See .env.example for full list.
APP_ENV=test
APP_SECRET=test_secret_not_for_production
APP_URL=http://localhost:8001
FRONTEND_URL=http://localhost:8001
SYNAPLAN_URL=http://localhost:8001
LOG_LEVEL=error
XDEBUG_MODE=off
###< SYMFONY TEST ENVIRONMENT ###

###> DATABASE (TEST) ###
# DB name in URL = "synaplan"; Symfony appends "_test" when APP_ENV=test → synaplan_test (matches MariaDB)
DATABASE_WRITE_URL=mysql://synaplan_test:synaplan_test@db_test:3306/synaplan?serverVersion=11.8&charset=utf8mb4
DATABASE_READ_URL=mysql://synaplan_test:synaplan_test@db_test:3306/synaplan?serverVersion=11.8&charset=utf8mb4
###< DATABASE ###

###> SECURITY (TEST) ###
CORS_ALLOW_ORIGIN=^https?://.*$
TOKEN_SECRET=test_token_secret_for_ci
LOCK_DSN=flock
OIDC_CLIENT_ID=test_client_id
OIDC_CLIENT_SECRET=test_client_secret
OIDC_DISCOVERY_URL=https://test.example.com

# OAuth / Auth (required by services.yaml – empty = disabled)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
###< SECURITY ###

###> INBOUND CHANNELS (TEST) ###
# WhatsApp: enabled for E2E gate; stub runs as Docker service whatsapp-stub:3999 (same network)
WHATSAPP_ENABLED=true
WHATSAPP_ACCESS_TOKEN=stub
WHATSAPP_WEBHOOK_VERIFY_TOKEN=
WHATSAPP_GRAPH_API_BASE_URL=http://whatsapp-stub:3999
###< INBOUND CHANNELS ###

###> EMAIL & MAILER (TEST) ###
MAILER_DSN=null://null
APP_SENDER_EMAIL=test@synaplan.local
APP_SENDER_NAME="Synaplan Test"

EMAIL_VERIFICATION_COOLDOWN_MINUTES=1
EMAIL_VERIFICATION_MAX_ATTEMPTS=10
EMAIL_VERIFICATION_CLEANUP_DAYS=1
###< EMAIL & MAILER ###

###> AI PROVIDERS (TEST) ###
ANTHROPIC_API_KEY=test-key
ANTHROPIC_BASE_URL=https://api.anthropic.com/v1
ANTHROPIC_DEFAULT_MODEL=claude-3-5-sonnet-20241022
ANTHROPIC_TIMEOUT=60
ANTHROPIC_MAX_RETRIES=3

OPENAI_API_KEY=test-key
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_DEFAULT_MODEL=gpt-4o
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
OPENAI_IMAGE_MODEL=dall-e-3
OPENAI_TTS_MODEL=tts-1
OPENAI_STT_MODEL=whisper-1

HUGGINGFACE_API_KEY=test-key
GROQ_API_KEY=test-key
GOOGLE_GEMINI_API_KEY=test-key
THEHIVE_API_KEY=test-key

OLLAMA_BASE_URL=http://ollama_test:11434
OLLAMA_DEFAULT_MODEL=llama3.2:3b
OLLAMA_EMBEDDING_MODEL=nomic-embed-text

AI_DEFAULT_PROVIDER=test
AI_FALLBACK_CHAIN=test
AI_FALLBACK_TIMEOUT=30
###< AI PROVIDERS ###

###> EXTERNAL SERVICES (TEST) ###
# Brave Search (optional; required by container because BraveSearchService is injected in widget flow)
BRAVE_SEARCH_API_KEY=
BRAVE_SEARCH_API_URL=https://api.search.brave.com/res/v1
BRAVE_SEARCH_ENABLED=false
BRAVE_SEARCH_COUNT=10
BRAVE_SEARCH_COUNTRY=us
BRAVE_SEARCH_SEARCH_LANG=en

TIKA_BASE_URL=http://tika_test:9998
TIKA_URL=http://tika_test:9998
TIKA_TIMEOUT_MS=10000
TIKA_RETRIES=1
TIKA_RETRY_BACKOFF_MS=500
TIKA_MIN_LENGTH=10
TIKA_MIN_ENTROPY=1.0

# Whisper.cpp Audio Transcription (Test)
WHISPER_BINARY=/usr/local/bin/whisper
WHISPER_MODELS_PATH=/var/www/backend/var/whisper
WHISPER_DEFAULT_MODEL=base
WHISPER_ENABLED=false
FFMPEG_BINARY=/usr/bin/ffmpeg

# Piper TTS (empty = use hardcoded default in provider)
SYNAPLAN_TTS_URL=

RASTERIZE_DPI=72
RASTERIZE_PAGE_CAP=5
RASTERIZE_TIMEOUT_MS=10000
###< EXTERNAL SERVICES ###

###> FILE STORAGE (TEST) ###
UPLOADS_DIR=/app/var/test_uploads
MAX_UPLOAD_SIZE=10M
###< FILE STORAGE ###

###> RATE LIMITING (TEST) ###
RATE_LIMIT_ENABLED=false
RATE_LIMIT_DEFAULT_LIMIT=1000
RATE_LIMIT_DEFAULT_WINDOW=60
###< RATE LIMITING ###

###> CIRCUIT BREAKER (TEST) ###
CIRCUIT_BREAKER_FAILURE_THRESHOLD=10
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2
CIRCUIT_BREAKER_TIMEOUT=30
CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=5
###< CIRCUIT BREAKER ###

###> FEATURE FLAGS (TEST) ###
FEATURE_SYMFONY_API_ENABLED=true
FEATURE_WIDGET_SYMFONY_ENABLED=true
FEATURE_RATE_LIMITING_STRICT=false
###< FEATURE FLAGS ###

###> PAYMENTS (TEST) ###
# Stripe (required by SubscriptionController/StripeWebhookController – dummy for container)
STRIPE_SECRET_KEY=
STRIPE_PUBLISHABLE_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PRICE_PRO=
STRIPE_PRICE_TEAM=
STRIPE_PRICE_BUSINESS=
STRIPE_PAYMENT_METHODS=card
###< PAYMENTS ###

###> VECTOR DATABASE (TEST) ###
# Qdrant (required by QdrantClientHttp – empty = memory service disabled)
QDRANT_SERVICE_URL=
QDRANT_SERVICE_API_KEY=
###< VECTOR DATABASE ###

###> MONITORING (TEST) ###
SENTRY_DSN=
PROMETHEUS_ENABLED=false
###< MONITORING ###
