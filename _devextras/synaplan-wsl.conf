# Apache configuration for Synaplan on WSL (subdirectory setup)
# Copy to: /etc/apache2/sites-available/synaplan-wsl.conf
# Enable with: sudo a2ensite synaplan-wsl.conf && sudo systemctl reload apache2
#
# URLs after setup:
#   Frontend: http://localhost/synaplan/frontend/
#   Backend:  http://localhost/synaplan/backend/

<VirtualHost *:80>
    ServerName localhost

    # ─────────────────────────────────────────────────────────────
    # Backend API: /synaplan/backend → Symfony via PHP-FPM
    # ─────────────────────────────────────────────────────────────
    Alias /synaplan/backend /wwwroot/synaplan/backend/public

    <Directory /wwwroot/synaplan/backend/public>
        AllowOverride All
        Require all granted
        FallbackResource /synaplan/backend/index.php
        
        # Enable .htaccess processing for Symfony
        Options -Indexes +FollowSymLinks
    </Directory>

    # PHP-FPM handler for Symfony
    <FilesMatch \.php$>
        SetHandler "proxy:unix:/run/php/php8.3-fpm.sock|fcgi://localhost"
    </FilesMatch>

    # ─────────────────────────────────────────────────────────────
    # Frontend (Production): /synaplan/frontend → Vue SPA dist
    # ─────────────────────────────────────────────────────────────
    Alias /synaplan/frontend /wwwroot/synaplan/frontend/dist

    <Directory /wwwroot/synaplan/frontend/dist>
        AllowOverride None
        Require all granted
        Options -Indexes
        
        # SPA client-side routing fallback
        FallbackResource /synaplan/frontend/index.html
    </Directory>

    # ─────────────────────────────────────────────────────────────
    # Optional: Uncomment to proxy to Vite dev server instead
    # (Comment out the Alias/Directory blocks above when using this)
    # ─────────────────────────────────────────────────────────────
    # ProxyPass /synaplan/frontend http://127.0.0.1:5173/synaplan/frontend
    # ProxyPassReverse /synaplan/frontend http://127.0.0.1:5173/synaplan/frontend

    # ─────────────────────────────────────────────────────────────
    # Logging
    # ─────────────────────────────────────────────────────────────
    ErrorLog ${APACHE_LOG_DIR}/synaplan-error.log
    CustomLog ${APACHE_LOG_DIR}/synaplan-access.log combined
</VirtualHost>

