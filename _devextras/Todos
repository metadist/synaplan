# Widget E2E Tests - Status & Todos

## ğŸ”§ Code-Ã„nderungen benÃ¶tigt

### ChatWidget.vue - data-testid Attribute hinzufÃ¼gen
- **Datei**: `frontend/src/components/widgets/ChatWidget.vue`
- **Status**: âš ï¸ TODO
- **Was zu tun**:
  - Zeile ~153: KI-Antwort Text â†’ `data-testid="message-ai-text"` (im `<div>` mit `v-html="renderMessageContent(message.content)"`)
  - Zeile ~153: Starttext (autoMessage) â†’ `data-testid="message-auto-text"` (fÃ¼r erste Nachricht mit `role='assistant'` und `type='text'`)
  - Zeile ~260: `showLimitWarning` Container (orange) â†’ `data-testid="warning-message-limit"`
    - Container: `bg-orange-500/10 border border-orange-500/30`
    - Text: "Approaching message limit" / "You have sent X of Y messages"
  - Zeile ~277: `limitReached` Container (red) â†’ `data-testid="error-message-limit-reached"`
    - Container: `bg-red-500/10 border border-red-500/30`
    - Text: "Limit reached" / "Limit reached details"
  - Zeile ~297: `fileUploadError` Container â†’ `data-testid="error-file-upload"`
  - Zeile ~306: `fileUploadLimitReached` Container â†’ `data-testid="error-file-upload-limit"`
  - Zeile ~348: `fileSizeError` Container â†’ `data-testid="error-file-size"`
- **Warum**: Tests verwenden aktuell CSS-Klassen (`.text-red-600`, `.text-orange-500`), sollten aber `data-testid` verwenden fÃ¼r bessere Wartbarkeit
- **Nach Ã„nderung**: Selectors in `frontend/tests/e2e/helpers/selectors.ts` aktualisieren und Tests anpassen

### Selectors.ts - Fehlende Selectors hinzufÃ¼gen
- **Datei**: `frontend/tests/e2e/helpers/selectors.ts`
- **Status**: âš ï¸ TODO
- **Was fehlt**:
  - âœ… Widget Einstellungen Tabs: `tabButton: '[data-testid="btn-tab"]'` (vorhanden)
  - âœ… Tab Sections: `brandingTab`, `behaviorTab`, `securityTab`, `assistantTab` (vorhanden: `behaviorTab`, `securityTab` - fehlen: `brandingTab`, `assistantTab`)
  - âœ… Einstellungsfelder: Viele vorhanden (`autoMessageInput`, `messageLimitInput`, `maxFileSizeInput`, `domainInput`), aber fehlen:
    - `input-position` (vorhanden im Code, fehlt in selectors)
    - `input-theme` (vorhanden im Code, fehlt in selectors)
    - `input-primary-color` (vorhanden im Code, fehlt in selectors)
    - `input-icon-color` (vorhanden im Code, fehlt in selectors)
    - `input-icon-upload` (vorhanden im Code, fehlt in selectors)
    - `input-file-limit` (vorhanden im Code, fehlt in selectors)
    - `input-widget-name` (vorhanden im Code, fehlt in selectors)
    - `input-selection-rules` (vorhanden im Code, fehlt in selectors)
    - `input-ai-model` (vorhanden im Code, fehlt in selectors)
    - `input-prompt-content` (vorhanden im Code, fehlt in selectors)
  - âŒ Widget Antwort-Text von KI: Fehlt komplett (kein data-testid im Code)
  - âŒ Widget Starttext (autoMessage): Fehlt komplett (kein data-testid im Code)
  - âŒ Error Messages: 
    - `fileUploadError`: Selector vorhanden `'[data-testid="text-file-upload-error"]'` aber **kein data-testid im Code** (Zeile ~297)
    - `fileUploadLimitReached`: Fehlt komplett (kein data-testid im Code, Zeile ~306)
    - `fileSizeError`: Nur CSS-Klasse vorhanden (kein data-testid im Code, Zeile ~348)

## ğŸ“ Test-Implementierungen

### Test 016: Widget file upload
- **Status**: âœ… Implementiert
- **Datei**: `frontend/tests/e2e/tests/widget.spec.ts` (Zeile ~214)
- **Offen**: Wartet auf data-testid Attribute (siehe oben)

### Test 017: Widget task prompt is applied
- **Status**: ğŸ“ Platzhalter
- **Datei**: `frontend/tests/e2e/tests/widget.spec.ts` (Zeile ~430)
- **TODO**:
  - Zeile ~460: Nachricht senden, die Task-Prompt-Verhalten triggert
  - Zeile ~461: AI-Antwort prÃ¼fen, ob sie Task-Prompt-Instruktionen folgt
  - Zeile ~468: Assert task prompt behavior (z.B. support-spezifische Antworten)

### Test 018: Widget file upload limit enforced
- **Status**: âœ… Implementiert
- **Datei**: `frontend/tests/e2e/tests/widget.spec.ts` (Zeile ~275)
- **Offen**: Wartet auf data-testid Attribute (siehe oben)

### Test 019: Widget max file size enforced
- **Status**: âœ… Implementiert
- **Datei**: `frontend/tests/e2e/tests/widget.spec.ts` (Zeile ~344)
- **Offen**: Wartet auf data-testid Attribute (siehe oben)

### createWidgetTestPage - Embed-Code nicht hard-coden
- **Datei**: `frontend/tests/e2e/helpers/widget.ts`
- **Status**: âš ï¸ TODO
- **Problem**: `createWidgetTestPage` hard-coded die Widget-Konfiguration (position, primaryColor, iconColor, defaultTheme, etc.)
- **Was zu tun**:
  - Embed-Code sollte wÃ¤hrend des Tests vom Backend geholt werden via `/api/v1/widgets/{widgetId}/embed`
  - Die Funktion sollte den tatsÃ¤chlichen Embed-Code vom Backend verwenden, nicht hard-coded Werte
  - Dies stellt sicher, dass Tests mit der tatsÃ¤chlichen Widget-Konfiguration laufen
- **API-Endpoint**: `GET /api/v1/widgets/{widgetId}/embed` gibt `embedCode` zurÃ¼ck
- **Warum**: Hard-coded Werte kÃ¶nnen von der tatsÃ¤chlichen Widget-Konfiguration abweichen und Tests unzuverlÃ¤ssig machen

## ğŸ“‹ NÃ¤chste Schritte

1. **data-testid Attribute hinzufÃ¼gen** (ChatWidget.vue)
   - 5 Container benÃ¶tigen data-testid (siehe oben)
2. **Selectors aktualisieren** (`frontend/tests/e2e/helpers/selectors.ts`)
3. **Tests auf data-testid umstellen** (`frontend/tests/e2e/tests/widget.spec.ts`)
4. **Test 017 vollstÃ¤ndig implementieren** (Task-Prompt-Assertions)
5. **createWidgetTestPage refactoren** - Embed-Code vom Backend holen statt hard-coden