var t=function(){"use strict";var t=Object.defineProperty,i=(i,n,o)=>((i,n,o)=>n in i?t(i,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[n]=o)(i,"symbol"!=typeof n?n+"":n,o);const n=new class{constructor(){i(this,"config",null),i(this,"button",null),i(this,"fullWidgetLoaded",!1),i(this,"fullWidgetLoading",!1)}async init(t){if(!t.widgetId)return;this.config={position:"bottom-right",primaryColor:"#007bff",iconColor:"#ffffff",buttonIcon:"chat",defaultTheme:"light",autoOpen:!1,autoMessage:"Hello! How can I help you today?",messageLimit:50,maxFileSize:10,widgetTitle:"Chat Support",apiUrl:window.__SYNAPLAN_API_URL__||"http://localhost:8000",allowFileUpload:!1,fileUploadLimit:3,...t};const i=async()=>{var t;await this.loadRemoteConfig(),this.createButton(),(null==(t=this.config)?void 0:t.autoOpen)&&this.loadFullWidget()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()}async loadRemoteConfig(){if(this.config)try{const t=this.config.apiUrl||"http://localhost:8000",i=await fetch(`${t}/api/v1/widget/${this.config.widgetId}/config`,{headers:{"X-Widget-Host":window.location.host}});if(!i.ok)return;const n=await i.json();n.success&&n.config&&(this.config={...this.config,...n.config,widgetTitle:n.name||this.config.widgetTitle})}catch(t){}}getIconContent(){var t,i,n;const o=(null==(t=this.config)?void 0:t.iconColor)||"#ffffff";if(null==(i=this.config)?void 0:i.buttonIconUrl)return`<img src="${this.config.buttonIconUrl}" alt="Chat" style="width: 32px; height: 32px; object-fit: contain;" />`;const e={chat:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="${o}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n      </svg>`,headset:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="${o}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>\n        <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>\n      </svg>`,help:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="${o}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <circle cx="12" cy="12" r="10"></circle>\n        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>\n        <line x1="12" y1="17" x2="12.01" y2="17"></line>\n      </svg>`,robot:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="${o}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <rect x="3" y="11" width="18" height="10" rx="2"></rect>\n        <circle cx="12" cy="5" r="2"></circle>\n        <path d="M12 7v4"></path>\n        <line x1="8" y1="16" x2="8" y2="16"></line>\n        <line x1="16" y1="16" x2="16" y2="16"></line>\n      </svg>`,message:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="${o}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>\n      </svg>`,support:`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="${o}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <circle cx="12" cy="12" r="10"></circle>\n        <path d="M12 16v-4"></path>\n        <path d="M12 8h.01"></path>\n      </svg>`};return e[(null==(n=this.config)?void 0:n.buttonIcon)||"chat"]||e.chat}createButton(){if(!this.config)return;this.button=document.createElement("div"),this.button.id="synaplan-widget-button";const t=this.config.position||"bottom-right";this.button.setAttribute("style",`\n      position: fixed;\n      ${{"bottom-right":"bottom: 20px; right: 20px;","bottom-left":"bottom: 20px; left: 20px;","top-right":"top: 20px; right: 20px;","top-left":"top: 20px; left: 20px;"}[t]}\n      z-index: 999999;\n      width: 60px;\n      height: 60px;\n      border-radius: 50%;\n      background-color: ${this.config.primaryColor};\n      cursor: pointer;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: transform 0.2s, box-shadow 0.2s;\n    `),this.button.innerHTML=this.getIconContent(),this.button.addEventListener("mouseenter",()=>{this.button.style.transform="scale(1.1)",this.button.style.boxShadow="0 6px 20px rgba(0,0,0,0.2)"}),this.button.addEventListener("mouseleave",()=>{this.button.style.transform="scale(1)",this.button.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)"}),this.button.addEventListener("click",()=>{this.loadFullWidget()}),document.body.appendChild(this.button)}async loadFullWidget(){var t,i;if(!this.fullWidgetLoaded&&!this.fullWidgetLoading){this.fullWidgetLoading=!0,this.button&&(this.button.innerHTML=`\n        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="${null==(t=this.config)?void 0:t.iconColor}" stroke-width="2">\n          <circle cx="12" cy="12" r="10" opacity="0.25"></circle>\n          <path d="M12 2 A10 10 0 0 1 22 12" opacity="1">\n            <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/>\n          </path>\n        </svg>\n      `);try{window.Vue||await this.loadScript("https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js");const t=document.createElement("script"),n=(null==(i=this.config)?void 0:i.apiUrl)||"http://localhost:8000";t.src=`${n}/widget-full.js`,t.type="text/javascript",t.onload=()=>{this.button&&(this.button.remove(),this.button=null),setTimeout(()=>{const t=window.SynaplanWidget;if(t&&"function"==typeof t.init){const i={...this.config,openImmediately:!0};t.init(i),this.fullWidgetLoaded=!0,setTimeout(()=>{var t;window.dispatchEvent(new CustomEvent("synaplan-widget-open",{detail:{widgetId:null==(t=this.config)?void 0:t.widgetId}}))},200)}else this.fullWidgetLoading=!1,this.createButton()},100)},t.onerror=t=>{this.button&&(this.button.innerHTML=this.getIconContent()),this.fullWidgetLoading=!1},document.head.appendChild(t)}catch(n){this.button&&(this.button.innerHTML=this.getIconContent()),this.fullWidgetLoading=!1}}}destroy(){this.button&&(this.button.remove(),this.button=null)}loadScript(t){return new Promise((i,n)=>{const o=document.createElement("script");o.src=t,o.type="text/javascript",o.onload=()=>i(),o.onerror=t=>n(t),document.head.appendChild(o)})}};return window.SynaplanWidget=n,n}();
